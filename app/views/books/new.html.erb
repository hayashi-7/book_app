<%= javascript_pack_tag "raty" %>
<%= form_with model: @book, local: true do |f| %>
  <%= render 'shared/error_messages', model: f.object %>
  <div class="books">
    <div class='book-images'>
      <div class="form-group">
        ISBN(13桁)<input id="isbn" type="text" name="isbn" value="" autofocus>
        <button id="getBook" class="btn btn-default">書籍情報取得</button>
      </div>
      <div class="book-image-prev">
        <p id="thumbnail"></p>
        <%= f.text_field :image ,id:"cover",class:"input-default imag"%>
      </div>
    </div>
    <div class="book-info">
        <%= f.label :title %>
    <div class="form-group">
        <%= f.text_field :title, class:"input-default", id:"title" %>
    </div>
        <%= f.label :author %>
    <div class="form-group">
        <%= f.text_field :author, class:"input-default", id:"author" %>
    </div>
        <%= f.label :tag_list %>
    <div class="form-group">
        <%= f.text_field :tag_list, value:@book.tag_list.join(''), id:"publisher", class:"input-default"%>
    </div>
        <%= f.label :category_id %>
    <div class='book-whie'>
        <%= f.collection_select(:category_id, Category.all, :id, :name, {}, {class:"input-default", id:"book-category"}) %>
    </div>
        <%= f.label :price %>
    <div class="form-group">
        <%= f.text_field :price, class:"input-default", id:"price" , class:"input-default"%>
    </div>
        <%= f.label :description %>
    <div class="form-group">
        <%=f.text_area :description, class:"input-text",id:"description" %>
    </div>
        <%= f.label :review %>
    <div class="form-group">
        <%= f.text_area :review, class:"input-text", id:"review" %>
    </div>
    <div class="form-group row" id="star">
        <%= f.label :star,'評価 ', class:'col-md-3 col-form-label' %>
        <%= f.hidden_field :star, id: :review_star %>
    </div>
    <%= f.submit '投稿する'%>
    </div>
  </div>
    <script>
        $(function() {
            $('#getBook').click( function( e ) {
                e.preventDefault();
                const isbn = $("#isbn").val();
                const url = "https://api.openbd.jp/v1/get?isbn=" + isbn;

                $.getJSON( url, function( data ) {
                    if( data[0] == null ) {
                        alert("データが見つかりません");
                    } else {
                        if( data[0].summary.cover == "" ){
                            $("#thumbnail").html('<img src=\"\" />');
                        } else {
                            $("#thumbnail").html('<img src=\"' + data[0].summary.cover + '\" style=\"border:solid 1px #000000\" />');
                        }
                        $("#title").val(data[0].summary.title);
                        $("#publisher").val(data[0].summary.publisher);
                        $("#author").val(data[0].summary.author);
                        $("#description").val(data[0].onix.CollateralDetail.TextContent[0].Text);
                        $("#cover").val(data[0].summary.cover);

                    }
                });
                
            });
        });
    </script>
    <script>
  $('#star').raty({
    size     : 36,
    starOff:  '<%= asset_path('star-off.png') %>',
    starOn : '<%= asset_path('star-on.png') %>',
    starHalf: '<%= asset_path('star-half.png') %>',
    scoreName: 'book[star]',
    half: true
  });
  </script> 

    
<%end%>
